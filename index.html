<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5203039798099176"
     crossorigin="anonymous"></script>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Bird Improved</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    background: linear-gradient(to bottom, #70c5ce 0%, #33a0d3 100%);
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    user-select: none;
    font-family: 'Press Start 2P', cursive;
    color: #fff;
  }

  canvas {
    background: #70c5ce;
    display: block;
    border-radius: 15px;
    box-shadow:
      0 8px 20px rgba(0, 0, 0, 0.4),
      inset 0 -5px 30px #3db5e5;
  }

  #score {
    position: absolute;
    top: 15px;
    font-size: 40px;
    letter-spacing: 2px;
    text-shadow: 2px 2px 6px #0008;
    user-select: none;
  }

  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    text-align: center;
    color: #fff;
    text-shadow: 2px 2px 6px #000c;
    user-select: none;
    pointer-events: none;
  }
</style>
</head>
<body>
<div id="score">0</div>
<div id="message">Press Space or Click to Start</div>
<canvas id="game" width="400" height="600"></canvas>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const messageEl = document.getElementById('message');

  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  // Sounds
  const sounds = {
    flap: new Audio('https://freesound.org/data/previews/341/341695_62469-lq.mp3'),
    hit: new Audio('https://freesound.org/data/previews/198/198841_2859972-lq.mp3'),
    point: new Audio('https://freesound.org/data/previews/109/109662_945474-lq.mp3')
  };

  sounds.flap.volume = 0.15;
  sounds.hit.volume = 0.3;
  sounds.point.volume = 0.2;

  // Bird properties
  const bird = {
    x: 80,
    y: HEIGHT / 2,
    width: 34,
    height: 24,
    gravity: 0.6,
    lift: -11,
    velocity: 0,
    rotation: 0,
    maxRotation: 25 * Math.PI / 180,
    minRotation: -60 * Math.PI / 180,
    jump() {
      this.velocity = this.lift;
      sounds.flap.currentTime = 0;
      sounds.flap.play();
    },
    update() {
      this.velocity += this.gravity;
      this.velocity *= 0.9; // air resistance
      this.y += this.velocity;

      // Rotation logic for bird tilting
      if (this.velocity < 0) {
        this.rotation = this.minRotation;
      } else if (this.velocity > 5) {
        this.rotation = this.maxRotation;
      } else {
        this.rotation = this.velocity / 5 * this.maxRotation;
      }

      if (this.y + this.height > HEIGHT - ground.height) {
        this.y = HEIGHT - ground.height - this.height;
        this.velocity = 0;
      }
      if (this.y < 0) {
        this.y = 0;
        this.velocity = 0;
      }
    },
    draw() {
      ctx.save();
      ctx.translate(this.x + this.width/2, this.y + this.height/2);
      ctx.rotate(this.rotation);

      // Bird body
      const grad = ctx.createRadialGradient(0, 0, this.width/4, 0, 0, this.width/2);
      grad.addColorStop(0, '#FFEB3B');
      grad.addColorStop(1, '#FBC02D');
      ctx.fillStyle = grad;
      ctx.strokeStyle = '#C9A900';
      ctx.lineWidth = 2;

      ctx.beginPath();
      ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.stroke();

      // Eye
      ctx.fillStyle = '#222';
      ctx.beginPath();
      ctx.ellipse(5, -3, 4, 4, 0, 0, Math.PI * 2);
      ctx.fill();

      // Beak
      ctx.fillStyle = '#FF9800';
      ctx.beginPath();
      ctx.moveTo(this.width/2, 0);
      ctx.lineTo(this.width/2 + 10, -5);
      ctx.lineTo(this.width/2 + 10, 5);
      ctx.closePath();
      ctx.fill();

      ctx.restore();
    }
  };

  // Ground properties
  const ground = {
    height: 80,
    speed: 2,
    x: 0,
    draw() {
      // draw a simple ground with grass effect
      const groundHeight = this.height;
      ctx.fillStyle = '#DEB887';
      ctx.fillRect(0, HEIGHT - groundHeight, WIDTH, groundHeight);

      // grass blades
      ctx.fillStyle = '#228B22';
      for(let i = this.x; i < WIDTH; i += 20) {
        ctx.beginPath();
        ctx.moveTo(i, HEIGHT - groundHeight);
        ctx.lineTo(i + 5, HEIGHT - groundHeight - 20);
        ctx.lineTo(i + 10, HEIGHT - groundHeight);
        ctx.closePath();
        ctx.fill();
      }
    },
    update() {
      this.x -= this.speed;
      if(this.x <= -20) this.x = 0;
    }
  };

  // Pipes properties
  const pipeWidth = 70;
  const pipeGap = 140;
  const pipeSpeed = 2;
  let pipes = [];

  function createPipe() {
    // Random height for the top pipe
    const minHeight = 50;
    const maxHeight = HEIGHT - ground.height - pipeGap - 50;
    const topHeight = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
    pipes.push({
      x: WIDTH,
      top: topHeight,
      bottom: HEIGHT - ground.height - (topHeight + pipeGap),
      passed: false
    });
  }

  // Game state
  let score = 0;
  let frames = 0;
  let gameState = 'start'; // 'start', 'playing', 'gameover'

  function resetGame() {
    pipes = [];
    score = 0;
    frames = 0;
    bird.y = HEIGHT / 2;
    bird.velocity = 0;
    gameState = 'start';
    scoreEl.textContent = '0';
    messageEl.textContent = 'Press Space or Click to Start';
  }

  // Detect collision between bird and pipes
  function collision(pipe) {
    const bx = bird.x;
    const by = bird.y;
    const bw = bird.width;
    const bh = bird.height;

    // Check top pipe
    if (
      bx + bw > pipe.x &&
      bx < pipe.x + pipeWidth &&
      by < pipe.top
    ) {
      return true;
    }
    // Check bottom pipe
    if (
      bx + bw > pipe.x &&
      bx < pipe.x + pipeWidth &&
      by + bh > HEIGHT - ground.height - pipe.bottom
    ) {
      return true;
    }
    return false;
  }

  // Draw pipes with nice shading
  function drawPipe(x, y, height, isTop) {
    ctx.fillStyle = '#228B22';
    ctx.strokeStyle = '#176517';
    ctx.lineWidth = 4;

    // Pipe body
    ctx.fillRect(x, y, pipeWidth, height);
    ctx.strokeRect(x, y, pipeWidth, height);

    // Pipe rim (ellipse)
    ctx.beginPath();
    if(isTop) {
      ctx.ellipse(x + pipeWidth/2, y + height, pipeWidth/2, 15, 0, Math.PI, 0, true);
    } else {
      ctx.ellipse(x + pipeWidth/2, y, pipeWidth/2, 15, 0, 0, Math.PI, true);
    }
    ctx.fill();
    ctx.stroke();
  }

  // Game loop
  function update() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    // Background gradient handled by CSS, no need to draw sky here

    // Update and draw ground
    ground.update();
    ground.draw();

    if(gameState === 'start') {
      bird.draw();
      messageEl.style.display = 'block';
    } else if (gameState === 'playing') {
      messageEl.style.display = 'none';

      // Update bird
      bird.update();
      bird.draw();

      // Pipes generation
      if (frames % 90 === 0) {
        createPipe();
      }

      // Move pipes and draw them
      for (let i = 0; i < pipes.length; i++) {
        const p = pipes[i];
        p.x -= pipeSpeed;

        drawPipe(p.x, 0, p.top, true); // top pipe
        drawPipe(p.x, HEIGHT - ground.height - p.bottom, p.bottom, false); // bottom pipe

        // Check collision
        if (collision(p)) {
          sounds.hit.play();
          gameState = 'gameover';
          messageEl.textContent = 'Game Over\nPress Space or Click to Restart';
          messageEl.style.display = 'block';
        }

        // Check if passed for scoring
        if (!p.passed && p.x + pipeWidth < bird.x) {
          score++;
          p.passed = true;
          scoreEl.textContent = score;
          sounds.point.play();
        }
      }

      // Remove off-screen pipes
      pipes = pipes.filter(p => p.x + pipeWidth > 0);

      // Check if bird hits ground or ceiling
      if (bird.y + bird.height >= HEIGHT - ground.height || bird.y <= 0) {
        sounds.hit.play();
        gameState = 'gameover';
        messageEl.textContent = 'Game Over\nPress Space or Click to Restart';
        messageEl.style.display = 'block';
      }
    } else if (gameState === 'gameover') {
      bird.draw();

      // Draw pipes
      for (let p of pipes) {
        drawPipe(p.x, 0, p.top, true);
        drawPipe(p.x, HEIGHT - ground.height - p.bottom, p.bottom, false);
      }
    }

    frames++;
    requestAnimationFrame(update);
  }

  // Controls
  function flap() {
    if (gameState === 'start') {
      gameState = 'playing';
      messageEl.style.display = 'none';
      bird.jump();
    } else if (gameState === 'playing') {
      bird.jump();
    } else if (gameState === 'gameover') {
      resetGame();
    }
  }

  window.addEventListener('keydown', e => {
    if (e.code === 'Space' || e.code === 'ArrowUp') {
      e.preventDefault();
      flap();
    }
  });

  window.addEventListener('mousedown', e => {
    flap();
  });

  // Start game
  resetGame();
  update();
})();
</script>
</body>
</html>
