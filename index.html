import time
import os

# --- Game Configuration ---
# You can change these to make the game harder or easier
# For example, on a slow computer, you might increase the time limit.
# TIME_LIMIT_SECONDS = 5  # This feature is removed for a simpler, prompt-based game

# --- Helper Functions ---
def clear_screen():
    """Clears the terminal screen."""
    os.system('cls' if os.name == 'nt' else 'clear')

def typewriter_effect(text, delay=0.03):
    """Prints text with a typewriter effect."""
    for char in text:
        print(char, end='', flush=True)
        time.sleep(delay)
    print()

def get_attempts():
    """Gets the attempt count from a file."""
    try:
        with open("attempts_stereo_madness.txt", "r") as f:
            return int(f.read())
    except (FileNotFoundError, ValueError):
        return 1

def save_attempts(attempts):
    """Saves the attempt count to a file."""
    with open("attempts_stereo_madness.txt", "w") as f:
        f.write(str(attempts))

# --- Level Definition ---
# Each dictionary is a unique challenge in the level.
LEVEL_STEREO_MADNESS = [
    {'progress': 5,  'desc': "The level begins. A single block approaches.", 'action': "jump"},
    {'progress': 10, 'desc': "Another block, easy does it.", 'action': "jump"},
    {'progress': 15, 'desc': "A staircase of four blocks! Quick succession!", 'action': "jump jump jump jump"},
    {'progress': 22, 'desc': "You see a glowing yellow pad on the ground.", 'action': "wait"},
    {'progress': 28, 'desc': "Another pad, but this one is on top of a block.", 'action': "jump"},
    {'progress': 30, 'mode_change': "You fly into a pink portal... YOU ARE NOW A SHIP!", 'new_controls': "Controls: Type sequences like 'up down' to navigate."},
    {'progress': 40, 'desc': "Navigate a simple corridor. Go up, then down.", 'action': "up down"},
    {'progress': 48, 'desc': "A trickier pass. Go up, stay level, then go up again.", 'action': "up wait up"},
    {'progress': 50, 'mode_change': "THE BEAT DROPS! You exit through an orange portal and the world FLIPS!", 'new_controls': "You are an upside-down cube. Type 'jump' to jump DOWN."},
    {'progress': 58, 'desc': "An upside-down platform. Jump down to clear the gap.", 'action': "jump"},
    {'progress': 65, 'desc': "Two spikes hang from the 'ground' below you. Make two quick jumps.", 'action': "jump jump"},
    {'progress': 66, 'mode_change': "Another ship portal! You're an upside-down ship in a tight space!", 'new_controls': "Navigate carefully! 'up' is now towards the middle."},
    {'progress': 75, 'desc': "The corridor is tight. Weave through: down, up, down.", 'action': "down up down"},
    {'progress': 81, 'desc': "You exit the portal, back to a normal cube.", 'action': ""}, # No action, just a transition
    {'progress': 85, 'desc': "The final stretch! A simple block jump.", 'action': "jump"},
    {'progress': 95, 'desc': "The final, iconic challenge... THREE SPIKES IN A ROW!", 'action': "jump jump jump"},
]

# --- Main Game Logic ---
def run_game():
    """The main game loop."""
    attempts = get_attempts()
    
    while True: # This loop represents one attempt
        clear_screen()
        print("========================================")
        print("        GEOMETRY DASH: TEXT MODE        ")
        print("          LEVEL 1: STEREO MADNESS       ")
        print(f"            ATTEMPT: {attempts}            ")
        print("========================================")
        time.sleep(2)

        is_dead = False
        current_progress = 0

        for challenge in LEVEL_STEREO_MADNESS:
            # Handle mode changes
            if 'mode_change' in challenge:
                print("\n" + ("-"*40))
                typewriter_effect(f"PROGRESS: {challenge['progress']}% ... {challenge['mode_change']}")
                if 'new_controls' in challenge:
                    typewriter_effect(f"--> {challenge['new_controls']}")
                print(("-")*40 + "\n")
                time.sleep(2.5)
                # If it's a pure transition, skip to next challenge
                if not challenge.get('action'): 
                    continue
            
            # Display the challenge
            print(f"--- Progress: {current_progress}% ---")
            typewriter_effect(challenge['desc'])
            
            # Get player input
            player_input = input("> ").strip().lower()

            # Check if the action is correct
            if player_input == challenge['action']:
                current_progress = challenge['progress']
                print("... Clear! ...\n")
                time.sleep(0.5)
            else:
                is_dead = True
                break # Exit the for loop for this attempt
        
        # --- End of Attempt ---
        if is_dead:
            print("\n" + "#" * 40)
            print("                CRASH!                ")
            print("#" * 40)
            attempts += 1
            save_attempts(attempts)
            time.sleep(2)
            # The outer while loop will restart the attempt
        else:
            # If the loop finishes without dying, you win
            clear_screen()
            print("\n" + "*" * 40)
            print("          LEVEL COMPLETE! â˜…           ")
            print(f"     Finished in {attempts} attempts.     ")
            print("*" * 40)
            
            # Reset attempts for the "next level"
            save_attempts(1) 
            
            print("\nYou have beaten the text-based Stereo Madness!")
            print("Run the program again to play 'Back on Track' (if it existed!).")
            break # Exit the main game loop

if __name__ == "__main__":
    try:
        run_game()
    except KeyboardInterrupt:
        print("\n\nGame closed. See you next time!")
