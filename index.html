<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Void Corsair v3</title>
    <style>
        body {
            background-color: #000;
            color: #eee;
            font-family: 'Consolas', 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 1000px;
            border: 2px solid #555;
            background-color: #000;
            box-shadow: 0 0 20px #00aaff;
            overflow: hidden;
        }

        canvas {
            position: absolute; top: 0; left: 0;
            background-color: transparent;
        }
        
        #background-canvas { z-index: 1; }
        #game-canvas { z-index: 2; }

        .ui-screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            z-index: 3;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }

        .ui-screen h1 { color: #00aaff; font-size: 3.5em; margin-bottom: 20px; text-shadow: 0 0 15px #00aaff; }
        .ui-screen h2 { color: #eee; margin-top: 40px; border-bottom: 1px solid #555; padding-bottom: 10px; width: 80%; }
        
        .menu-button {
            padding: 15px 40px; margin: 15px; font-size: 1.5em; cursor: pointer;
            background-color: transparent; border: 2px solid #00aaff; color: #00aaff;
            transition: background-color 0.2s, color 0.2s;
        }
        .menu-button:hover { background-color: #00aaff; color: #000; }
        .menu-button:disabled { border-color: #555; color: #555; cursor: not-allowed; }

        #hangar-content { display: flex; width: 100%; height: 70%; justify-content: space-around; align-items: flex-start; }
        #upgrade-panel, #player-status-panel { width: 45%; }
        .upgrade-item { display: flex; justify-content: space-between; align-items: center; margin: 15px 0; font-size: 1.2em; }
        .upgrade-cost { color: #ffff00; }
        .player-stat { font-size: 1.2em; margin: 10px 0; color: #ccc; }
        
        #post-mission-screen h1 { color: #00ff7f; }

        #hud {
            position: absolute; bottom: 10px; left: 10px; color: white;
            font-size: 1.2em; z-index: 4; pointer-events: none; text-shadow: 1px 1px 2px black;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="background-canvas" width="800" height="1000"></canvas>
        <canvas id="game-canvas" width="800" height="1000"></canvas>
        <div id="main-menu-screen" class="ui-screen"></div>
        <div id="mission-select-screen" class="ui-screen"></div>
        <div id="hangar-screen" class="ui-screen"></div>
        <div id="post-mission-screen" class.ui-screen"></div>
        <div id="hud"></div>
    </div>

<script>
class Game {
    constructor() {
        this.container = document.getElementById('game-container');
        this.bgCanvas = document.getElementById('background-canvas');
        this.gameCanvas = document.getElementById('game-canvas');
        this.bgCtx = this.bgCanvas.getContext('2d');
        this.ctx = this.gameCanvas.getContext('2d');

        this.uiScreens = {
            mainMenu: document.getElementById('main-menu-screen'),
            missionSelect: document.getElementById('mission-select-screen'),
            hangar: document.getElementById('hangar-screen'),
            postMission: document.getElementById('post-mission-screen')
        };
        this.hud = document.getElementById('hud');
        this.keysPressed = {};
        this.gameState = 'mainMenu';
        
        this.playerData = {
            credits: 1000, // Start with more credits to test upgrades
            materials: { "Scrap Metal": 10, "Titanium": 0 },
            missions_completed: 0,
            upgrades: {
                health: 0,  // levels, not absolute values
                shield: 0,
                fireRate: 0,
                speed: 0,
            }
        };

        this.init();
    }

    // --- HELPER FUNCTIONS ---
    rand(min, max) { return Math.random() * (max - min) + min; }
    randInt(min, max) { return Math.floor(this.rand(min, max + 1)); }

    init() {
        // --- DATA ---
        this.MISSIONS = {
            "m1": { id: "m1", name: "Scout Patrol", difficulty: 1, waves: [{ type: "fighter", count: 5 }], rewards: { credits: 50, materials: { "Scrap Metal": [2, 5] } } },
            "m2": { id: "m2", name: "Convoy Defense", difficulty: 2, waves: [{ type: "fighter", count: 7 }, { type: "gunship", count: 2 }], rewards: { credits: 100, materials: { "Scrap Metal": [5, 10], "Titanium": [0, 1] } } },
            "m3": { id: "m3", name: "Pirate Hunt", difficulty: 3, waves: [{ type: "fighter", count: 6 }, { type: "gunship", count: 3 }, { type: "fighter", count: 4 }], rewards: { credits: 150, materials: { "Scrap Metal": [8, 12], "Titanium": [1, 2] } } },
            "boss1": { id: "boss1", name: "The Scrap King", difficulty: 5, waves: [{ type: "boss", count: 1 }], rewards: { credits: 1000, materials: { "Scrap Metal": [20, 30], "Titanium": [5, 8] } } }
        };
        this.ENEMY_STATS = {
            'fighter': { health: 10, speed: 3, size: { w: 40, h: 40 }, color: '#ff4444', shootCooldown: 0 },
            'gunship': { health: 30, speed: 1.5, size: { w: 50, h: 50 }, color: '#ff9900', shootCooldown: 2000 },
            'boss': { health: 500, speed: 0.5, size: { w: 150, h: 150 }, color: '#800080', shootCooldown: 800 }
        };
        this.UPGRADE_COSTS = {
            health: level => 100 + level * 50,
            shield: level => 100 + level * 50,
            fireRate: level => 200 + level * 100,
            speed: level => 150 + level * 75
        };

        // --- BACKGROUND ---
        this.stars = Array.from({ length: 200 }, () => ({ x: this.rand(0, 800), y: this.rand(0, 1000), r: this.rand(0.5, 2.5) }));
        
        // --- EVENT LISTENERS ---
        window.addEventListener('keydown', (e) => { this.keysPressed[e.key.toLowerCase()] = true; });
        window.addEventListener('keyup', (e) => { this.keysPressed[e.key.toLowerCase()] = false; });
        
        this.showScreen('mainMenu');
        requestAnimationFrame((timestamp) => this.loop(timestamp));
    }

    loop(timestamp) {
        this.ctx.clearRect(0, 0, 800, 1000);
        this.bgCtx.fillStyle = '#000';
        this.bgCtx.fillRect(0, 0, 800, 1000);

        this.stars.forEach(star => {
            star.y += star.r / 2;
            if (star.y > 1000) star.y = 0;
            this.bgCtx.fillStyle = 'white';
            this.bgCtx.beginPath(); this.bgCtx.arc(star.x, star.y, star.r, 0, Math.PI * 2); this.bgCtx.fill();
        });

        if (this.gameState === 'in_mission') {
            this.update(timestamp);
            this.draw();
        }
        requestAnimationFrame((timestamp) => this.loop(timestamp));
    }

    // --- UI MANAGEMENT ---
    showScreen(screenName) {
        this.gameState = screenName;
        Object.values(this.uiScreens).forEach(s => s.style.display = 'none');
        this.hud.style.display = 'none';

        const screen = this.uiScreens[screenName];
        if (screen) {
            screen.style.display = 'flex';
            this[`render${screenName.charAt(0).toUpperCase() + screenName.slice(1)}Screen`]();
        }
    }

    renderMainMenuScreen() {
        this.uiScreens.mainMenu.innerHTML = `
            <h1>VOID CORSAIR</h1>
            <button id="start-game-btn" class="menu-button">Start Game</button>
            <button id="hangar-btn" class="menu-button">Hangar</button>
        `;
        document.getElementById('start-game-btn').onclick = () => this.showScreen('missionSelect');
        document.getElementById('hangar-btn').onclick = () => this.showScreen('hangar');
    }

    renderMissionSelectScreen() {
        const screen = this.uiScreens.missionSelect;
        let missionHTML = '';
        const bossUnlocked = this.playerData.missions_completed >= 4;
        for (const id in this.MISSIONS) {
            if (id === 'boss1' && !bossUnlocked) continue;
            const mission = this.MISSIONS[id];
            missionHTML += `<div class="menu-button ${id === 'boss1' ? 'boss-mission' : ''}" data-mission-id="${id}">
                <h3>${mission.name}</h3><p>Difficulty: ${mission.difficulty}</p>
            </div>`;
        }
        screen.innerHTML = `
            <h1>MISSION SELECT</h1>
            <div id="mission-board">${missionHTML}</div>
            <button id="mission-back-btn" class="menu-button" style="margin-top: 40px;">Back to Main Menu</button>`;
        
        screen.querySelectorAll('.menu-button[data-mission-id]').forEach(el => {
            el.onclick = () => this.startMission(el.dataset.missionId);
        });
        document.getElementById('mission-back-btn').onclick = () => this.showScreen('mainMenu');
    }
    
    renderHangarScreen() {
        const screen = this.uiScreens.hangar;
        const upgrades = this.playerData.upgrades;

        const canAfford = (type) => this.playerData.credits >= this.UPGRADE_COSTS[type](upgrades[type]);
        
        screen.innerHTML = `
            <h1>HANGAR</h1>
            <div id="hangar-content">
                <div id="upgrade-panel">
                    <h2>UPGRADES</h2>
                    <div class="upgrade-item">
                        <span>Max Hull (+10)</span>
                        <span class="upgrade-cost">${this.UPGRADE_COSTS.health(upgrades.health)}c</span>
                        <button class="menu-button" data-upgrade="health" ${canAfford('health') ? '' : 'disabled'}>Buy</button>
                    </div>
                    <div class="upgrade-item">
                        <span>Max Shield (+10)</span>
                        <span class="upgrade-cost">${this.UPGRADE_COSTS.shield(upgrades.shield)}c</span>
                        <button class="menu-button" data-upgrade="shield" ${canAfford('shield') ? '' : 'disabled'}>Buy</button>
                    </div>
                    <div class="upgrade-item">
                        <span>Fire Rate (-15ms)</span>
                        <span class="upgrade-cost">${this.UPGRADE_COSTS.fireRate(upgrades.fireRate)}c</span>
                        <button class="menu-button" data-upgrade="fireRate" ${canAfford('fireRate') ? '' : 'disabled'}>Buy</button>
                    </div>
                    <div class="upgrade-item">
                        <span>Speed (+0.5)</span>
                        <span class="upgrade-cost">${this.UPGRADE_COSTS.speed(upgrades.speed)}c</span>
                        <button class="menu-button" data-upgrade="speed" ${canAfford('speed') ? '' : 'disabled'}>Buy</button>
                    </div>
                </div>
                <div id="player-status-panel">
                    <h2>PILOT STATUS</h2>
                    <p class="player-stat credits">Credits: ${this.playerData.credits}c</p>
                    <p class="player-stat">Hull Level: ${upgrades.health}</p>
                    <p class="player-stat">Shield Level: ${upgrades.shield}</p>
                    <p class="player-stat">Fire Rate Level: ${upgrades.fireRate}</p>
                    <p class="player-stat">Speed Level: ${upgrades.speed}</p>
                </div>
            </div>
            <button id="hangar-back-btn" class="menu-button">Back to Main Menu</button>
        `;
        document.getElementById('hangar-back-btn').onclick = () => this.showScreen('mainMenu');
        screen.querySelectorAll('button[data-upgrade]').forEach(btn => {
            btn.onclick = () => this.purchaseUpgrade(btn.dataset.upgrade);
        });
    }

    renderPostMissionScreen(rewards) {
        const screen = this.uiScreens.postMission;
        let materialsHTML = '';
        for (const mat in rewards.materials) {
            materialsHTML += `<p>${mat}: +${rewards.materials[mat]}</p>`;
        }
        screen.innerHTML = `
            <h1>MISSION COMPLETE</h1>
            <div id="rewards-summary">
                <p class="credits">Credits: +${rewards.credits}c</p>
                ${materialsHTML}
            </div>
            <button id="return-to-menu-btn" class="menu-button">Continue</button>`;
        document.getElementById('return-to-menu-btn').onclick = () => this.showScreen('mainMenu');
    }

    // --- GAME LOGIC ---
    purchaseUpgrade(type) {
        const level = this.playerData.upgrades[type];
        const cost = this.UPGRADE_COSTS[type](level);
        if (this.playerData.credits >= cost) {
            this.playerData.credits -= cost;
            this.playerData.upgrades[type]++;
            this.renderHangarScreen(); // Re-render to update values
        }
    }

    startMission(missionId) {
        this.currentMission = this.MISSIONS[missionId];
        this.gameState = 'in_mission';
        Object.values(this.uiScreens).forEach(s => s.style.display = 'none');
        this.hud.style.display = 'block';

        this.player = new Player(this);
        this.bullets = []; this.enemyBullets = []; this.enemies = []; this.particles = [];
        this.waveIndex = 0; this.enemiesToSpawnInWave = 0; this.lastSpawnTime = 0;
    }
    
    endMission(success) {
        this.container.classList.remove('shake');
        if (success) {
            const rewards = { credits: 0, materials: {} };
            const missionRewards = this.currentMission.rewards;
            rewards.credits = missionRewards.credits;
            this.playerData.credits += rewards.credits;
            
            for (const mat in missionRewards.materials) {
                const [min, max] = missionRewards.materials[mat];
                const amount = this.randInt(min, max);
                if (amount > 0) {
                    rewards.materials[mat] = amount;
                    this.playerData.materials[mat] = (this.playerData.materials[mat] || 0) + amount;
                }
            }
            if (this.currentMission.id !== 'boss1') this.playerData.missions_completed++;
            else this.playerData.missions_completed = 0;
            this.showScreen('postMission');
            this.renderPostMissionScreen(rewards);
        } else {
            this.showScreen('mainMenu');
        }
    }

    update(timestamp) {
        if (!this.player || !this.player.active) {
            this.endMission(false);
            return;
        }

        if (this.waveIndex < this.currentMission.waves.length) {
            const wave = this.currentMission.waves[this.waveIndex];
            if (this.enemiesToSpawnInWave < wave.count && timestamp - this.lastSpawnTime > 1000) {
                this.enemies.push(new Enemy(this, wave.type));
                this.enemiesToSpawnInWave++;
                this.lastSpawnTime = timestamp;
            }
            if (this.enemiesToSpawnInWave === wave.count && this.enemies.length === 0) {
                this.waveIndex++; this.enemiesToSpawnInWave = 0;
            }
        } else if (this.enemies.length === 0) {
            this.endMission(true);
            return;
        }
        
        this.player.update(timestamp);
        this.enemies.forEach(e => e.update(timestamp));
        this.bullets.forEach(b => b.update());
        this.enemyBullets.forEach(b => b.update());
        this.particles.forEach(p => p.update());
        
        this.checkCollisions();
        this.bullets = this.bullets.filter(b => b.active);
        this.enemyBullets = this.enemyBullets.filter(b => b.active);
        this.enemies = this.enemies.filter(e => e.active);
        this.particles = this.particles.filter(p => p.active);
    }

    draw() {
        this.player.draw();
        this.enemies.forEach(e => e.draw());
        this.bullets.forEach(b => b.draw());
        this.enemyBullets.forEach(b => b.draw());
        this.particles.forEach(p => p.draw());

        let shieldBar = `SHIELD: [${'|'.repeat(Math.ceil(this.player.shield / (this.player.maxShield/10)))}${' '.repeat(10 - Math.ceil(this.player.shield / (this.player.maxShield/10)))}]`;
        let hullBar = `HULL:   [${'|'.repeat(Math.ceil(this.player.health / (this.player.maxHealth/10)))}${' '.repeat(10 - Math.ceil(this.player.health / (this.player.maxHealth/10)))}]`;
        this.hud.innerHTML = `<pre>${shieldBar}\n${hullBar}</pre>`;
    }
    
    checkCollisions() { /* ... Collision logic remains the same ... */ }
    createExplosion(x, y, color) { /* ... Explosion logic remains the same ... */ }
}

// --- GAME OBJECT CLASSES (Player class is heavily updated) ---
class Player {
    constructor(game) {
        this.game = game;
        const upgrades = game.playerData.upgrades;
        this.w = 50; this.h = 55;
        this.pos = { x: 400 - this.w / 2, y: 900 };
        this.speed = 5 + (upgrades.speed * 0.5);
        this.maxHealth = 100 + (upgrades.health * 10);
        this.health = this.maxHealth;
        this.maxShield = 100 + (upgrades.shield * 10);
        this.shield = this.maxShield;
        this.shieldRechargeDelay = 3000;
        this.shieldRechargeRate = 10;
        this.lastHitTime = 0;
        this.gunCooldown = 250 - (upgrades.fireRate * 15);
        this.lastShot = 0;
        this.active = true;
    }
    draw() {
        const ctx = this.game.ctx;
        const p = this.pos;
        if (this.shield > 0) {
            ctx.fillStyle = `rgba(0, 170, 255, ${0.1 + (this.shield / this.maxShield) * 0.3})`;
            ctx.beginPath(); ctx.arc(p.x + this.w / 2, p.y + this.h / 2, this.w / 2 + 10, 0, Math.PI * 2); ctx.fill();
        }

        // Engine Thruster
        if (Math.random() > 0.3) {
            const thrusterX = p.x + this.w / 2;
            const thrusterY = p.y + this.h + 5;
            this.game.particles.push(new Particle(this.game, thrusterX + this.game.rand(-5,5), thrusterY, '#ffa500', { lifespan: 0.3, size: this.game.rand(2,5), vel: {x: this.game.rand(-1,1), y: this.game.rand(3,6)} }));
        }

        // Ship Body
        ctx.fillStyle = '#c0c0c0'; // Silver
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        // Main Fuselage
        ctx.beginPath();
        ctx.moveTo(p.x + this.w * 0.5, p.y); // Nose
        ctx.lineTo(p.x, p.y + this.h * 0.8); // Left wing base
        ctx.lineTo(p.x + this.w * 0.2, p.y + this.h); // Left engine
        ctx.lineTo(p.x + this.w * 0.8, p.y + this.h); // Right engine
        ctx.lineTo(p.x + this.w, p.y + this.h * 0.8); // Right wing base
        ctx.closePath();
        ctx.fill(); ctx.stroke();
        // Cockpit
        ctx.fillStyle = '#00aaff';
        ctx.strokeStyle = '#00ffff';
        ctx.beginPath();
        ctx.moveTo(p.x + this.w * 0.5, p.y + 10);
        ctx.lineTo(p.x + this.w * 0.3, p.y + 25);
        ctx.lineTo(p.x + this.w * 0.7, p.y + 25);
        ctx.closePath();
        ctx.fill(); ctx.stroke();
    }
    update(timestamp) { /* ... Unchanged ... */ }
    shoot(timestamp) { /* ... Unchanged ... */ }
    takeDamage(amount) { /* ... Unchanged ... */ }
}

// --- OTHER CLASSES ---
class Bullet { /* ... Unchanged ... */ }
class Enemy { /* ... Unchanged ... */ }
class Particle {
    constructor(game, x, y, color, options = {}) {
        this.game = game;
        this.pos = {x: x, y: y};
        this.vel = options.vel || {x: game.rand(-5, 5), y: game.rand(-5, 5)};
        this.lifespan = options.lifespan || 1;
        this.color = color;
        this.size = options.size || game.rand(2, 6);
        this.active = true;
    }
    draw() {
        this.game.ctx.globalAlpha = this.lifespan;
        this.game.ctx.fillStyle = this.color;
        this.game.ctx.beginPath(); this.game.ctx.arc(this.pos.x, this.pos.y, this.size, 0, Math.PI * 2); this.game.ctx.fill();
        this.game.ctx.globalAlpha = 1.0;
    }
    update() {
        this.pos.x += this.vel.x; this.pos.y += this.vel.y;
        this.lifespan -= 0.02;
        if (this.lifespan <= 0) this.active = false;
    }
}

// Add the unchanged methods back to the Game class
Game.prototype.checkCollisions = function() {
    this.bullets.forEach(b => {
        this.enemies.forEach(e => {
            if (b.pos.x < e.pos.x + e.w && b.pos.x + b.w > e.pos.x && b.pos.y < e.pos.y + e.h && b.pos.y + b.h > e.pos.y) {
                b.active = false; e.health -= 10;
                if (e.health <= 0) { e.active = false; this.createExplosion(e.pos.x + e.w/2, e.pos.y + e.h/2, e.color); }
            }
        });
    });
    this.enemyBullets.forEach(b => {
        if (this.player.active && b.pos.x < this.player.pos.x + this.player.w && b.pos.x + b.w > this.player.pos.x && b.pos.y < this.player.pos.y + this.player.h && b.pos.y + b.h > this.player.pos.y) {
            b.active = false; this.player.takeDamage(10);
        }
    });
    this.enemies.forEach(e => {
         if (this.player.active && this.player.pos.x < e.pos.x + e.w && this.player.pos.x + this.player.w > e.pos.x && this.player.pos.y < e.pos.y + e.h && this.player.pos.y + this.player.h > e.pos.y) {
             e.active = false; this.createExplosion(e.pos.x + e.w/2, e.pos.y + e.h/2, e.color); this.player.takeDamage(25);
         }
    });
};
Game.prototype.createExplosion = function(x, y, color) {
    for (let i = 0; i < 30; i++) this.particles.push(new Particle(this, x, y, color));
};

// Add the unchanged methods back to the Player class
Player.prototype.update = function(timestamp) {
    if (this.game.keysPressed['a'] || this.game.keysPressed['arrowleft']) this.pos.x -= this.speed;
    if (this.game.keysPressed['d'] || this.game.keysPressed['arrowright']) this.pos.x += this.speed;
    if (this.game.keysPressed['w'] || this.game.keysPressed['arrowup']) this.pos.y -= this.speed;
    if (this.game.keysPressed['s'] || this.game.keysPressed['arrowdown']) this.pos.y += this.speed;
    if (this.pos.x < 0) this.pos.x = 0;
    if (this.pos.x + this.w > 800) this.pos.x = 800 - this.w;
    if (this.pos.y < 0) this.pos.y = 0;
    if (this.pos.y + this.h > 1000) this.pos.y = 1000 - this.h;
    if (this.game.keysPressed[' ']) this.shoot(timestamp);
    if (timestamp - this.lastHitTime > this.shieldRechargeDelay && this.shield < this.maxShield) {
        this.shield += this.shieldRechargeRate / 60;
        if (this.shield > this.maxShield) this.shield = this.maxShield;
    }
};
Player.prototype.shoot = function(timestamp) {
    if (timestamp - this.lastShot > this.gunCooldown) {
        this.lastShot = timestamp;
        this.game.bullets.push(new Bullet(this.game, this.pos.x + this.w / 2, this.pos.y));
    }
};
Player.prototype.takeDamage = function(amount) {
    this.lastHitTime = performance.now();
    this.game.container.classList.add('shake');
    setTimeout(() => this.game.container.classList.remove('shake'), 500);
    if (this.shield > 0) {
        this.shield -= amount;
        if (this.shield < 0) { this.health += this.shield; this.shield = 0; }
    } else { this.health -= amount; }
    if (this.health <= 0) {
        this.health = 0; this.active = false;
        this.game.createExplosion(this.pos.x + this.w/2, this.pos.y + this.h/2, '#c0c0c0');
    }
};

// Add unchanged classes
function defineUnchangedClasses() {
    window.Bullet = class Bullet {
        constructor(game, x, y, isEnemy = false) { this.game = game; this.w = isEnemy ? 8 : 5; this.h = isEnemy ? 8 : 15; this.pos = {x: x - this.w / 2, y: y}; this.speed = isEnemy ? 8 : 15; this.color = isEnemy ? '#ff7777' : '#ffff00'; this.isEnemy = isEnemy; this.active = true; }
        draw() { this.game.ctx.fillStyle = this.color; if (this.isEnemy) { this.game.ctx.beginPath(); this.game.ctx.arc(this.pos.x + this.w/2, this.pos.y + this.h/2, this.w/2, 0, Math.PI * 2); this.game.ctx.fill(); } else { this.game.ctx.fillRect(this.pos.x, this.pos.y, this.w, this.h); } }
        update() { this.pos.y += this.isEnemy ? this.speed : -this.speed; if (this.pos.y < -this.h || this.pos.y > 1000) this.active = false; }
    };
    window.Enemy = class Enemy {
        constructor(game, type) { this.game = game; const stats = this.game.ENEMY_STATS[type]; this.w = stats.size.w; this.h = stats.size.h; this.pos = { x: game.rand(0, 800 - this.w), y: -this.h }; this.speed = stats.speed; this.health = stats.health; this.maxHealth = stats.health; this.color = stats.color; this.shootCooldown = stats.shootCooldown; this.lastShot = 0; this.active = true; }
        draw() { this.game.ctx.fillStyle = this.color; this.game.ctx.strokeStyle = '#111'; this.game.ctx.lineWidth = 3; this.game.ctx.fillRect(this.pos.x, this.pos.y, this.w, this.h); this.game.ctx.strokeRect(this.pos.x, this.pos.y, this.w, this.h); this.game.ctx.fillStyle = '#00aaff'; this.game.ctx.fillRect(this.pos.x + this.w/2 - 5, this.pos.y + 10, 10, 10); if (this.health < this.maxHealth) { this.game.ctx.fillStyle = '#555'; this.game.ctx.fillRect(this.pos.x, this.pos.y - 10, this.w, 5); this.game.ctx.fillStyle = '#00ff7f'; this.game.ctx.fillRect(this.pos.x, this.pos.y - 10, this.w * (this.health / this.maxHealth), 5); } }
        update(timestamp) { this.pos.y += this.speed; if (this.pos.y > 1000) this.active = false; if (this.shootCooldown > 0 && timestamp - this.lastShot > this.shootCooldown) { this.lastShot = timestamp; this.game.enemyBullets.push(new Bullet(this.game, this.pos.x + this.w / 2, this.pos.y + this.h, true)); } }
    };
}
defineUnchangedClasses();

// Start the game
window.onload = () => new Game();
</script>
</body>
</html>
